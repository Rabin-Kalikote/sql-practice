{"backend_state":"running","connection_file":"/tmp/xdg-runtime-user/jupyter/kernel-a328cfb7-1a82-4a7d-9e08-f13e20ff5319.json","kernel":"python3","kernel_error":"","kernel_state":"idle","kernel_usage":{"cpu":0,"memory":0},"last_ipynb_save":1709186079908,"metadata":{"nbgrader":{"__altered":false,"__hash":-688996206,"_root":{"entries":[["size",6],["_root",{"entries":[["size",6],["_root",{"entries":[["size",6],["_root",{"entries":[["size",6],["_root",{"entries":[["size",6],["_root",{"entries":[["size",6],["_root",{"entries":[["size",1],["_root",{"entries":[["cocalc_minimal_stubs",true]],"ownerID":{}}],["__ownerID",null],["__hash",912286151],["__altered",false],["cocalc_minimal_stubs",true]],"ownerID":{}}],["__ownerID",null],["__hash",853781301],["__altered",false],["cocalc_minimal_stubs",true]],"ownerID":{}}],["__ownerID",null],["__hash",615395691],["__altered",false],["cocalc_minimal_stubs",true]],"ownerID":{}}],["__ownerID",null],["__hash",132559425],["__altered",false],["cocalc_minimal_stubs",true]],"ownerID":{}}],["__ownerID",null],["__hash",534908128],["__altered",false],["cocalc_minimal_stubs",true]],"ownerID":{}}],["__ownerID",null],["__hash",-40698486],["__altered",false],["cocalc_minimal_stubs",true]],"ownerID":{}}],["__ownerID",null],["__hash",423065938],["__altered",false],["cocalc_minimal_stubs",true]],"ownerID":{}},"cocalc_minimal_stubs":true,"size":6}},"trust":true,"type":"settings"}
{"cell_type":"code","end":1709183527627,"exec_count":3,"id":"a80e9f","input":"# Testing Part 1 (Setup)\nimport sqlite3\nfrom nose.tools import assert_equal\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n# Running all the code in act7insert.sql\nwith open('act7insert.sql') as file:\n    cur.executescript(file.read())\n\n# Checking that the tables are created \ntables = {t[0] for t in cur.execute(\"SELECT tbl_name FROM sqlite_master;\").fetchall()}\n\nassert_equal(tables, {'CourseDetails', 'CourseMeetings', 'CourseStudent', 'Courses', 'Yotes'})\n\n# Checking the column names\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"a80e9f","locked":true,"points":1,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":1,"start":1709183527551,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183527637,"exec_count":4,"id":"b9dfce","input":"# Testing Part 2\nimport sqlite3\nfrom nose.tools import assert_equal, assert_in\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n# Checking Keys and Constraints:\ntable_info = cur.execute(\"PRAGMA table_info('Yotes');\").fetchall()\n\nprimary_keys = {t[1] for t in table_info if t[-1]}\nassert_equal(primary_keys, {'YoteId'}, 'Checking the Primary Key')\n\nnot_nulls = {t[1] for t in table_info if t[3]}\nassert_in('Email', not_nulls, 'Checking the attributes that cannot be null')\n\n# Checking Emails are unique:\ntry:\n    cur.executescript(\"\"\"  \n    INSERT INTO Yotes (Email) VALUES ('a@b.edu'), ('a@b.edu');\n    \"\"\")\nexcept Exception as err:\n    message2 = str(err)\n\nassert_equal(message2, 'UNIQUE constraint failed: Yotes.Email')\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"b9dfce","locked":true,"points":2,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":2,"start":1709183527633,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183527645,"exec_count":5,"id":"573880","input":"# Testing Part 3a\nimport sqlite3\nfrom nose.tools import assert_equal, assert_greater\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n#Checking Keys:\ntable_info = cur.execute(\"PRAGMA table_info('CourseDetails');\").fetchall()\n\nprimary_keys = {t[1] for t in table_info if t[-1]}\nassert_equal(primary_keys, {'CourseSubject', 'CourseNumber'}, 'Checking the Primary Key')\n\nmystery = {t[1] for t in table_info if t[3]}\nassert_greater(len(mystery), 1, 'Checking if you added the extra constraint(s) to enforce the Primary Key constraint')\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"573880","locked":true,"points":2,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":3,"start":1709183527642,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183527665,"exec_count":6,"id":"bc58d3","input":"# Testing Part 3b\nimport sqlite3\nfrom nose.tools import assert_equal\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n#Checking Keys:\ntable_info = cur.execute(\"PRAGMA table_info('CourseStudent');\").fetchall()\n\nprimary_keys = {t[1] for t in table_info if t[-1]}\nassert_equal(primary_keys, {'CourseId', 'StudentId'}, 'Checking the Primary Key')\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"bc58d3","locked":true,"points":1,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":4,"start":1709183527659,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183527672,"exec_count":7,"id":"302604","input":"# Testing Part 3c\nimport sqlite3\nfrom nose.tools import assert_equal, assert_not_equal\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n#Checking Keys:\ntables = {t[0] for t in cur.execute(\"SELECT tbl_name FROM sqlite_master;\").fetchall()}\n\nfor table in tables:\n    table_info = cur.execute(f\"PRAGMA table_info({table});\").fetchall()\n    primary_keys = {t[1] for t in table_info if t[-1]}\n    assert_not_equal(len(primary_keys), 0, 'Checking that each table has a primary key')\n\n# There are hidden tests which will check if you have the correct Primary Keys.\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"302604","locked":true,"points":1,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":5,"start":1709183527669,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183527680,"exec_count":8,"id":"791136","input":"# Testing Part 3d part 1\nimport sqlite3\nfrom nose.tools import assert_in\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n#Checking Keys:\nfk_info = {t for t in cur.execute(\"PRAGMA foreign_key_list('Courses');\").fetchall()}\n\nforeign_keys = {(fk[2], fk[3], fk[4]) for fk in fk_info}\nassert_in(('Yotes', 'InstructorId', 'YoteId'), foreign_keys, 'Checking a FK')\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"791136","locked":true,"points":1,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":6,"start":1709183527676,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183527689,"exec_count":9,"id":"a05c29","input":"# Testing Part 3d part 2\nimport sqlite3\nfrom nose.tools import assert_in, assert_equal, assert_not_equal\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n#Checking Keys:\nfk_info = {t for t in cur.execute(\"PRAGMA foreign_key_list('Courses');\").fetchall()}\n\nforeign_keys = {(fk[2], fk[3], fk[4]) for fk in fk_info}\nassert_in(('CourseDetails', 'CourseSubject', 'CourseSubject',), foreign_keys, 'Checking CourseSubject FK')\nassert_in(('CourseDetails', 'CourseNumber', 'CourseNumber',),   foreign_keys, 'Checking CourseNumber FK')\n\nfks = [fk for fk in fk_info if fk[2] == 'CourseDetails']\nassert_equal(len(fks), 2,              'Checking the reference to CourseDetails is setup as a *compound* FK')\nassert_equal(fks[0][0], fks[1][0],     'Checking the reference to CourseDetails is setup as a *compound* FK')\nassert_not_equal(fks[0][1], fks[1][1], 'Checking the reference to CourseDetails is setup as a *compound* FK')\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"a05c29","locked":true,"points":1,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":7,"start":1709183527685,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183527767,"exec_count":10,"id":"240db1","input":"# Testing Part 3e\nimport sqlite3\nfrom nose.tools import assert_equal\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n#Checking Keys:\ntables = {t[0] for t in cur.execute(\"SELECT tbl_name FROM sqlite_master;\").fetchall()}\nfk_count = sum([len(cur.execute(f\"PRAGMA foreign_key_list({table});\").fetchall()) for table in tables])\n\nassert_equal(fk_count, 6, \"Checking the number of FK's\")\n\n# There are hidden tests which will check if you have the correct Foreign Keys.\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"240db1","locked":true,"points":2,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":8,"start":1709183527761,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183527787,"exec_count":11,"id":"0b444f","input":"# Testing Part 3f\nimport sqlite3\nfrom nose.tools import assert_equal, assert_not_equal\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n#Checking Actions:\ntables = {t[0] for t in cur.execute(\"SELECT tbl_name FROM sqlite_master;\").fetchall()}\nfk_info = {f for table in tables for f in cur.execute(f\"PRAGMA foreign_key_list({table});\").fetchall()}\n\nactions = {fk[-2] for fk in fk_info if fk[2] == 'CourseDetails'}\nfor a in actions:\n    assert_not_equal(a, 'NO ACTION', 'Checking ON DELETE actions for references to CourseDetails')\n\naction = [fk[-2] for fk in fk_info if fk[3] == 'InstructorId'][0]\nassert_not_equal(action, 'NO ACTION', 'Checking ON DELETE action for InstructorId')\n\n# There are hidden tests which will check if you have the correct actions.\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"0b444f","locked":true,"points":2,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":9,"start":1709183527784,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183527960,"exec_count":12,"id":"574cdb","input":"# Testing Part 3g\nimport sqlite3\nfrom nose.tools import assert_in\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n# Checking constraint:\ntable_info = cur.execute(\"PRAGMA table_info('CourseDetails');\").fetchall()\n\nnot_nulls = {t[1] for t in table_info if t[3]}\nassert_in('Title', not_nulls, 'Checking the attributes that cannot be null')\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"574cdb","locked":true,"points":1,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":10,"start":1709183527959,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183527969,"exec_count":13,"id":"c95a63","input":"# Testing Part 3h\nimport sqlite3\nfrom nose.tools import assert_in\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n# Checking constraint:\ntests = [(11, 'CHECK constraint failed'),\n         (-1, 'CHECK constraint failed'),\n         (10, 'No Error'),\n         (0, 'No Error'),\n         (4, 'No Error')]\nnum = 100\n\nfor credit, msg in tests:\n    num += 1\n    try:\n        cur.executescript(f\"\"\"  \n        INSERT INTO CourseDetails (CourseSubject, CourseNumber, Title, Credits) VALUES ('ABC', '{num}', 'Computers', {credit});\n        \"\"\")\n        message = 'No Error'\n    except Exception as err:\n        message = str(err)\n\n    assert_in(msg, message, f'Checking credits = {credit}')\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"c95a63","locked":true,"points":1,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":11,"start":1709183527966,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183527977,"exec_count":14,"id":"e4731e","input":"# Testing Part 3i\nimport sqlite3\nfrom nose.tools import assert_equal\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n# Checking default:\ntable_info = cur.execute(\"PRAGMA table_info('Courses');\").fetchall()\n\nfor t in table_info:\n    if t[1] == 'Section':\n        default = t[-2]\n\nassert_equal(default, '1', 'Checking the default')\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"e4731e","locked":true,"points":1,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":12,"start":1709183527973,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183528068,"exec_count":15,"id":"63904e","input":"# Testing Part 3j\nimport sqlite3\nfrom nose.tools import assert_in\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n# Checking constraint:\ntry:\n    cur.executescript(f\"\"\"  \n    INSERT INTO CourseMeetings (StartTime, EndTime) VALUES ('10:00', '09:50');\n    \"\"\")\n    message = 'No Error'\nexcept Exception as err:\n    message = str(err)\n\nassert_in('CHECK constraint failed', message)\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"63904e","locked":true,"points":1,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":13,"start":1709183528060,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183528080,"exec_count":16,"id":"b6ea03","input":"# Testing Part 3k\nimport sqlite3\nfrom nose.tools import assert_in\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n\n# Checking constraint:\ntry:\n    cur.executescript(f\"\"\"  \n    INSERT INTO Courses (CourseSubject, CourseNumber, Term) VALUES ('ABC', '123', 'Sp');\n    \"\"\")\n    message = 'No Error'\nexcept Exception as err:\n    message = str(err)\n\nassert_in('CHECK constraint failed', message, \"Checking Term = 'Sp'\")\n\ntry:\n    cur.executescript(f\"\"\"  \n    INSERT INTO Courses (CourseSubject, CourseNumber, Term) VALUES ('ABC', '123', 'F');\n    \"\"\")\n    message = 'No Error'\nexcept Exception as err:\n    message = str(err)\n\nassert_in('CHECK constraint failed', message, \"Checking Term = 'F'\")\n\ntry:\n    cur.executescript(f\"\"\"  \n    INSERT INTO Courses (CourseSubject, CourseNumber, Term) VALUES ('ABC', '123', 'Fall');\n    \"\"\")\n    message = 'No Error'\nexcept Exception as err:\n    message = str(err)\n\nassert_in('No Error', message, \"Checking Term = 'Fall'\")\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"b6ea03","locked":true,"points":1,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":14,"start":1709183528076,"state":"done","type":"cell"}
{"cell_type":"code","end":1709183528174,"exec_count":17,"id":"4632e4","input":"# Testing Part 4\nimport sqlite3\nfrom nose.tools import assert_equal, assert_greater\n\n# Setting up sqlite3 for unit tests\ncon = sqlite3.connect(':memory:')\ncur = con.cursor()\n\n# Running all the code in act7create.sql\nwith open('act7create.sql') as file:\n    cur.executescript(file.read())\n    \n# Running all the code in act7insert.sql\nwith open('act7insert.sql') as file:\n    cur.executescript(file.read())\n    \n# Checking there is data in the database\ntables = {t[0] for t in cur.execute(\"SELECT tbl_name FROM sqlite_master;\").fetchall()}\nassert_equal(tables, {'CourseDetails', 'CourseMeetings', 'CourseStudent', 'Courses', 'Yotes'})\n\nfor table in tables:\n    rows = cur.execute(f\"SELECT * FROM {table};\").fetchall()\n    assert_greater(len(rows), 2)\n\n# Checking there are no FK violators\nfk_violators = cur.execute(\"PRAGMA foreign_key_check;\").fetchall()\nassert_equal(len(fk_violators), 0, \"Checking that there are no FK violations\")\n\ncon.close()","kernel":"python3","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":true,"grade_id":"4632e4","locked":true,"points":4,"schema_version":3,"solution":false,"task":false}},"no_halt":true,"pos":15,"start":1709183528172,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"a37223","input":"# Tests for Activity 7\n## Adding Keys and Constraints to the Yote DB","metadata":{"deletable":false,"editable":false,"nbgrader":{"grade":false,"grade_id":"a37223","locked":true,"schema_version":3,"solution":false,"task":false}},"pos":0,"state":"done","type":"cell"}
{"id":0,"time":1709183071734,"type":"user"}
{"last_load":1709053662477,"type":"file"}